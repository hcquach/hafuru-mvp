<div class="collab-wrap">
  <div class="left-bar-collab">
    <div class="left-title-collab">
    </div>

    <div class="chat-collab">
      <div class="col-xs-12">
        <% @chat_room = ChatRoom.find(@collaboration.chat_room_id) %>
        <div class="chat-header text-center">
          <h4>Collaborate with
            <%= @collaboration.match.matching_gratitude.user == current_user ? @collaboration.match.matched_gratitude.user.username.capitalize : @collaboration.match.matching_gratitude.user.username.capitalize %>
          </h4>
        </div>
        <div class="messages">
          <% @chat_room.messages.each do |message| %>
            <%= render partial: "messages/message", locals: { message: message, user_is_messages_author: message.user == current_user } %>
          <% end %>
        </div>
        <div id="create-message">
          <%= simple_form_for [ @chat_room, Message.new ], remote: true do |f| %>
            <%= f.input :content, label: false %>
          <% end %>
        </div>
      </div>
      <% content_for :after_js do %>
        <script>
          scrollLastMessageIntoView();
          App['chat_room_<%= @chat_room.id %>'] = App.cable.subscriptions.create(
            { channel: 'ChatRoomsChannel', chat_room_id: <%= @chat_room.id %> },
            {
              received: (data) => {
                if (data.current_user_id !== <%= current_user.id %>) {
                  const messagesContainer = document.querySelector('.messages');
                  messagesContainer.insertAdjacentHTML('beforeend', data.message_partial);
                  scrollLastMessageIntoView();
                }
              }
            });
        </script>
      <% end %>
    </div>
  </div>


  </div>
</div>
